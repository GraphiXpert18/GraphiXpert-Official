// @desc    Update a Project item
// @route   PUT /api/Project/:id
// @access  Private/Admin
router.put('/:id', protect, admin, upload.fields([
    { name: 'thumbnail', maxCount: 1 },
    { name: 'images', maxCount: 10 },
    { name: 'videos', maxCount: 5 }
]), async (req, res) => {
    const { title, category, description, videoUrl, caseStudy, featured } = req.body;
    
    try {
        const Project = await Project.findById(req.params.id);

        if (Project) {
            Project.title = title || Project.title;
            Project.category = category || Project.category;
            Project.description = description || Project.description;
            Project.videoUrl = videoUrl || Project.videoUrl;
            Project.caseStudy = caseStudy || Project.caseStudy;
            Project.featured = featured !== undefined ? featured === 'true' : Project.featured;

            // Update thumbnail if provided
            if (req.files?.thumbnail) {
                Project.thumbnail = `/uploads/${req.files.thumbnail[0].filename}`;
            }

            // Add new images if provided
            if (req.files?.images) {
                const newImages = req.files.images.map(file => `/uploads/${file.filename}`);
                Project.images = [...Project.images, ...newImages];
            }

            // Add new videos if provided
            if (req.files?.videos) {
                const newVideos = req.files.videos.map(file => `/uploads/${file.filename}`);
                Project.videos = [...(Project.videos || []), ...newVideos];
            }

            // Auto-select first image as thumbnail if no thumbnail exists
            if (!Project.thumbnail && Project.images.length > 0) {
                Project.thumbnail = Project.images[0];
            }

            const updatedProject = await Project.save();
            res.json(updatedProject);
        } else {
            res.status(404).json({ message: 'Project item not found' });
        }
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

